
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../Chapter%201/">
      
      
        <link rel="next" href="../Chapter%204/">
      
      
      <link rel="icon" href="../../../../image/head.jpg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.5.49">
    
    
      
        <title>Chapter 2 - hhhjyz</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.6f8fc17f.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../css/extra.css">
    
      <link rel="stylesheet" href="https://fonts.loli.net/css2?family=Noto+Serif+SC&display=swap">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-webfont@1.1.0/style.css">
    
      <link rel="stylesheet" href="https://unpkg.com/katex@0/dist/katex.min.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
   <link href="../../../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="teal" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#introduction" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="hhhjyz" class="md-header__button md-logo" aria-label="hhhjyz" data-md-component="logo">
      
  <img src="../../../../image/head.jpg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            hhhjyz
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Chapter 2
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="hhhjyz" class="md-nav__button md-logo" aria-label="hhhjyz" data-md-component="logo">
      
  <img src="../../../../image/head.jpg" alt="logo">

    </a>
    hhhjyz
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    课程笔记
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            课程笔记
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
        
          
          <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    高级数据结构与算法分析
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            高级数据结构与算法分析
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Final/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Review
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Lec8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lec8 Dynamic Programming
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Lec%209/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lec9 Greedy Algorithm
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Lec%2010/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lec10 NP-Completeness
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Lec11/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lec11 Approximation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Lec%2012/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lec12 Local Search
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../ads/Lec14/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lec14 Parallel Algorithm
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    计算机组成
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            计算机组成
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter%201/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 1
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Chapter 2
  </span>
  

      </a>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter%204/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 4
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter%205/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 5
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../Chapter%206/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Chapter 6
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../physics/%E5%A4%A7%E7%89%A9%E5%AE%9E%E9%AA%8C%E6%9C%9F%E6%9C%AB%E5%A4%8D%E4%B9%A0/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    大学物理实验
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    自学
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            自学
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    工具
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            工具
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../self-study/tools/conda/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    conda
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../use/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ZJU常用
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  

<nav class="md-nav md-nav--secondary" aria-label="目录">
  
  
  
    
  
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h1>
<h1 id="operations">Operations<a class="headerlink" href="#operations" title="Permanent link">&para;</a></h1>
<blockquote>
<p>[!info] Design Principle
1.Simplicity favors regularity
2.Smaller is faster
3. make common case faster</p>
</blockquote>
<p>operations of the Computer Hardware
每一条指令只能完成一个operation
每一条指令只含有三个变量
- word 32bit
- doubleword 64bit
经常用的变量放到寄存器里面</p>
<h1 id="1-risc-v-registers">1 RISC-V Registers<a class="headerlink" href="#1-risc-v-registers" title="Permanent link">&para;</a></h1>
<p>在RISC-V体系结构中，寄存器的大小为64位
![[file-20241028125513896.png]]</p>
<h2 id="1-memory-operands">1 Memory Operands<a class="headerlink" href="#1-memory-operands" title="Permanent link">&para;</a></h2>
<p>operands 只能是寄存器</p>
<h2 id="2-signed-and-unsigned-numbers">2 Signed and Unsigned Numbers<a class="headerlink" href="#2-signed-and-unsigned-numbers" title="Permanent link">&para;</a></h2>
<p><strong>对二进制补码求相反数</strong>：所有位取反加一</p>
<h1 id="operands">Operands<a class="headerlink" href="#operands" title="Permanent link">&para;</a></h1>
<ul>
<li>Main memory used for composite data<ul>
<li>数组，结构，动态数据</li>
</ul>
</li>
<li>To apply arithmetic operations <ul>
<li>把数据加载到寄存器</li>
<li>把结果存储回内存</li>
</ul>
</li>
<li>地址使用byte进行索引</li>
<li>RISC-V  是小端的（<strong>就是低位字节排放在内存的低地址端，高位字节排放在内存的高地址端</strong>）</li>
<li>RISC-V不需要数据自然对齐，但是会变慢</li>
<li><strong>对齐</strong>：word的起始地址必须是4的倍数，doubleword的起始地址必须是8的倍数，对齐会使数据的传输更快
<a class="glightbox" href="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410201041475.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410201041475.png" /></a></li>
</ul>
<p><a class="glightbox" href="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410121519144.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410121519144.png" /></a>
<strong>RISC-V instructions</strong>
- 指令都是32位</p>
<h1 id="representing-instructions-in-the-computer">Representing Instructions in the computer<a class="headerlink" href="#representing-instructions-in-the-computer" title="Permanent link">&para;</a></h1>
<ul>
<li>计算机中的所有信息都是用二进制来表示的</li>
<li>指令也用二进制编码</li>
<li>寄存器映射到数据</li>
<li>RISC-V指令<ul>
<li>编码为32bit的word</li>
<li>少量格式编码操作代码</li>
<li>规整</li>
</ul>
</li>
</ul>
<h2 id="1-translating-assembly-into-machine-code">1 Translating assembly into machine code<a class="headerlink" href="#1-translating-assembly-into-machine-code" title="Permanent link">&para;</a></h2>
<p>![[file-20241028160825421.png]]</p>
<h2 id="2-risc-v">2 RISC-V 指令格式<a class="headerlink" href="#2-risc-v" title="Permanent link">&para;</a></h2>
<p><a class="glightbox" href="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410121527462.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410121527462.png" /></a></p>
<h3 id="21-r">2.1 R 型指令<a class="headerlink" href="#21-r" title="Permanent link">&para;</a></h3>
<p>用于寄存器</p>
<table>
<thead>
<tr>
<th style="text-align: center;">funct7</th>
<th style="text-align: left;">rs2</th>
<th>rs1</th>
<th>funct3</th>
<th>rd</th>
<th>opcode</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">7 bits</td>
<td style="text-align: left;">5 bits</td>
<td>5 bits</td>
<td>3 bits</td>
<td>5 bits</td>
<td>7 bits</td>
</tr>
<tr>
<td style="text-align: center;">- opcode : operation code</td>
<td style="text-align: left;"></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td style="text-align: center;">- rd: destination register number</td>
<td style="text-align: left;"></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td style="text-align: center;">- funct3: 3-bit function code(additional code)</td>
<td style="text-align: left;"></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td style="text-align: center;">- rs1: 第一个源寄存器</td>
<td style="text-align: left;"></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td style="text-align: center;">- rs2：第二个源寄存器</td>
<td style="text-align: left;"></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td style="text-align: center;">- funct7：7-bit function code(additional code)</td>
<td style="text-align: left;"></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td style="text-align: center;">### 2.2 I-型指令</td>
<td style="text-align: left;"></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td style="text-align: center;">用于带一个常数的指令和load指令</td>
<td style="text-align: left;"></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>在移位指令中前六位funct6
<a class="glightbox" href="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410201102663.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410201102663.png" /></a>
- rs1: source or base address register number
- immediate: constant operand, or offset added to base address</p>
<p>p 2s-complement, sign extended</p>
<h3 id="23-s">2.3 S型指令<a class="headerlink" href="#23-s" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410201103646.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410201103646.png" /></a></p>
<ul>
<li>rs1: 寄存器基址</li>
<li>rs2: 源操作数寄存器</li>
<li>immediate ： offset added to base address</li>
</ul>
<h3 id="24-u-type">2.4 U-type<a class="headerlink" href="#24-u-type" title="Permanent link">&para;</a></h3>
<p>用于与高位立即数相关的操作</p>
<h3 id="25-sb-type">2.5 SB-type<a class="headerlink" href="#25-sb-type" title="Permanent link">&para;</a></h3>
<p>用于条件分支指令
![[file-20241020193641182.png]]</p>
<h3 id="26-uj-type">2.6 UJ-type<a class="headerlink" href="#26-uj-type" title="Permanent link">&para;</a></h3>
<p>用于无条件分支指令（<code>jal</code>,<code>jalr</code>）
- <code>rd</code>用于存放链接地址（即返回地址）
- 如果跳转地址（立即数）过大，超过了 20 位，那么可以先用<code>lui</code>指令（<a href="https://note.noughtq.top/hardware/co/2#wide-immediate-operands">后面</a>会讲到这条指令，也会介绍类似的方法）将高 20 位数字放入临时寄存器中，然后再用<code>jalr</code>指令，跳转到地址 <code>剩余的低位数字(临时寄存器)</code> 上</p>
<h3 id="27-stored-program-computer">2.7 Stored Program Computer<a class="headerlink" href="#27-stored-program-computer" title="Permanent link">&para;</a></h3>
<ul>
<li>Instructions represented in binary</li>
<li>指令和数据存储在内存中</li>
<li>程序在程序上操作（编译器）</li>
</ul>
<h2 id="3-logical-operations">3 Logical Operations<a class="headerlink" href="#3-logical-operations" title="Permanent link">&para;</a></h2>
<p><a class="glightbox" href="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410201112080.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410201112080.png" /></a>
<a class="glightbox" href="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410201115433.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410201115433.png" /></a></p>
<h3 id="31-shift-operations">3.1 Shift Operations<a class="headerlink" href="#31-shift-operations" title="Permanent link">&para;</a></h3>
<p><a class="glightbox" href="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410141441996.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410141441996.png" /></a>
- immed 决定位置如何移动
- 左移
    - <code>slli rd, rs1, imm</code>即<code>rd = rs1&lt;&lt; imm</code>
- 右移
    - <code>srli</code></p>
<h3 id="32-and-operations">3.2 And Operations<a class="headerlink" href="#32-and-operations" title="Permanent link">&para;</a></h3>
<h3 id="33-or-operations">3.3 Or Operations<a class="headerlink" href="#33-or-operations" title="Permanent link">&para;</a></h3>
<h3 id="34-xor-operations">3.4 XOR Operations<a class="headerlink" href="#34-xor-operations" title="Permanent link">&para;</a></h3>
<h2 id="4-instructions-for-making-decisions">4 Instructions for making decisions<a class="headerlink" href="#4-instructions-for-making-decisions" title="Permanent link">&para;</a></h2>
<h3 id="41-branch-instructions">4.1 Branch instructions<a class="headerlink" href="#41-branch-instructions" title="Permanent link">&para;</a></h3>
<ul>
<li><code>beq registers1, register2,L1</code><blockquote>
<p>branch if equal</p>
</blockquote>
</li>
<li><code>bne register1,register2,L1</code><blockquote>
<p>branch if not equal </p>
</blockquote>
</li>
</ul>
<h3 id="42-compare-operations">4.2 Compare Operations<a class="headerlink" href="#42-compare-operations" title="Permanent link">&para;</a></h3>
<ul>
<li><code>slt x5,x19,x20   #x5=1 if x19&lt;x20</code></li>
<li><code>blt rs1,rs2,L1</code><blockquote>
<p>if(rs1&lt;rs2)branch to instruction labeled L1</p>
</blockquote>
</li>
<li><code>bge rs1,rs2,L1</code><blockquote>
<p>if (rs1&gt;=rs2)branch to instruction labeled L1</p>
</blockquote>
</li>
</ul>
<h3 id="43-jump-register-jump-address-table">4.3 Jump register &amp; jump address table<a class="headerlink" href="#43-jump-register-jump-address-table" title="Permanent link">&para;</a></h3>
<ul>
<li>Jump-and-link register
<code>jalr x1,100(x6)</code>
跳转到所给地址执行程序，exit之后执行PC+4的指令</li>
</ul>
<h3 id="44-basic-blocks">4.4 Basic Blocks<a class="headerlink" href="#44-basic-blocks" title="Permanent link">&para;</a></h3>
<p>A basic block is a sequence of instructions with
- 没有branch跳出程序，也不会有branch突然跳到本程序的中间</p>
<blockquote>
<p>所以编译器可以进行充分的优化</p>
</blockquote>
<h2 id="5-suporting-procedures-in-computer-hardware">5 Suporting Procedures in Computer Hardware<a class="headerlink" href="#5-suporting-procedures-in-computer-hardware" title="Permanent link">&para;</a></h2>
<p><strong><em>进程调用的六大步骤</em></strong>：
1. 传入参数
2. 程序的控制权交给这个进程
3. 得到存储资源
4. 完成desired task
5. 使主程序能得到结果
6. 归还控制权</p>
<p>program counter（PC） ：用于保存当前执行指令的地址</p>
<h3 id="51-procedure-call-instructions">5.1 Procedure Call Instructions<a class="headerlink" href="#51-procedure-call-instructions" title="Permanent link">&para;</a></h3>
<ul>
<li>Instruction for procedures<code>jal x1,ProcedureAddress</code>:
        下一条指令地址在x1，跳转到目标地址</li>
<li><strong>Procedure <em>return</em></strong>: jump and link register<br />
<code>jalr x0, 0(x1)</code><ul>
<li>Like jal, but jumps to <code>0 + address in x1</code></li>
<li>Use <code>x0</code> as rd (<code>x0</code> cannot be changed)</li>
<li>Can also be used for computed jump</li>
</ul>
</li>
</ul>
<h3 id="52-using-more-registers">5.2 Using More Registers<a class="headerlink" href="#52-using-more-registers" title="Permanent link">&para;</a></h3>
<ul>
<li>More Registers for prodedures calling:<ul>
<li>a0-a7(x10-x17):八个传参和返回值寄存器</li>
<li>ra/x1:返回时的地址</li>
</ul>
</li>
<li>Stack<ul>
<li>对于寄存器溢出，理想的数据结构是stack</li>
<li>In RISC-V，the stack pointer is x2/sp</li>
<li>push/pop</li>
<li>Stack grow from higher address to lower address<ul>
<li>Push:<code>sp=sp-8</code></li>
<li>pop:<code>sp=sp+8</code><blockquote>
<p>[!info] compiling a leaf procedure
<a class="glightbox" href="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410201428750.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410201428750.png" /></a>
<a class="glightbox" href="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410201429202.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="image.png" src="https://cdn.jsdelivr.net/gh/hhhjyz/photos@main/202410201429202.png" /></a></p>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="53-nested-procedures">5.3 Nested Procedures<a class="headerlink" href="#53-nested-procedures" title="Permanent link">&para;</a></h3>
<p>同样是压栈<span class="arithmatex">\(\rightarrow\)</span>出栈</p>
<blockquote>
<p>[!note] procedure
![[file-20241020193257872.png]]</p>
</blockquote>
<p>![[file-20241020194218195.png]]
<mark>todo</mark>
父函数保证：子函数能随便使用temporary registers，返回给父函数的时候，值可以被改变
子函数保证：返回给父函数的时候，saved registers 保持父函数调用子函数前的值</p>
<h2 id="6-local-data-on-the-stack">6 Local Data on the Stack<a class="headerlink" href="#6-local-data-on-the-stack" title="Permanent link">&para;</a></h2>
<p>在栈上给新数据分配内存
- <strong>过程帧</strong>(procedure frame)/<strong>活动记录</strong>(activation record)：栈内的一段空间，里面存储了过程所需的寄存器和变量 。
- 寄存器<code>x8</code>（或者称为<code>fp</code>）是一个<strong>帧指针</strong>(frame pointer)，它指向过程帧内第一个double word。</p>
<div class="codehilite"><pre><span></span><code>- 栈指针会随着过程的进行而不断变化，因此在过程的不同阶段访问同一个变量或寄存器时，用到的偏移量会不断变化，从而带来理解上的不便
- 而帧指针在过程中为局部变量提供一个稳定的基址寄存器

![](https://note.noughtq.top/hardware/co/images/C2/18.png)
</code></pre></div>

<ul>
<li>
<p>寄存器<code>x3</code>（或者称为<code>gp</code>）是一个<strong>全局指针</strong>(global pointer)，它指向的是静态 (static) 数据。</p>
</li>
<li>
<p>Linux 系统上 RISC-V 的内存分配示意图：</p>
<p><a class="glightbox" href="https://note.noughtq.top/hardware/co/images/C2/19.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="" src="https://note.noughtq.top/hardware/co/images/C2/19.png" /></a></p>
<ul>
<li>最底下的内存是保留的空间（不可访问）</li>
<li>第二层的内存用于存放 RISC-V 的机器码，称为<strong>文本段</strong>(text segment)</li>
<li>第三层的内存称为<strong>静态数据段</strong>(static data segment)，用于放置立即数和其他静态变量</li>
<li>最上层同时存放栈和动态数据（比如链表等），其中存放动态数据的数据结构称为<strong>堆</strong>(heap)。注意到栈和堆位于这块内存的两端，分别自顶向下和自底向上增长<ul>
<li>C 语言中使用<code>malloc()</code>在堆中分配空间，使用<code>free()</code>释放堆内的空间。如果过晚释放空间，就会造成内存泄露问题；如果过早释放空间，就会造成悬空指针 (dangling pointers)（类似野指针）问题。
![[file-20241028190531928.png]]</li>
</ul>
</li>
</ul>
<h1 id="communicating-with-people-character-data">Communicating with people character data<a class="headerlink" href="#communicating-with-people-character-data" title="Permanent link">&para;</a></h1>
</li>
<li>
<p>Byte-encoded character sets</p>
<ul>
<li>ASCII</li>
<li>Latin-1</li>
</ul>
</li>
<li>Unicode: 32-bit character set</li>
</ul>
<h2 id="1-bytehalfwordword-operations">1 Byte/halfword/word Operations<a class="headerlink" href="#1-bytehalfwordword-operations" title="Permanent link">&para;</a></h2>
<ul>
<li>RISC-V byte/halfword/word load/store<ul>
<li><code>lb rd, offset(rs1)</code></li>
<li>`lh rd, offset(rs1)</li>
<li><code>lw rd, offser(rs1)</code>
![[file-20241021131319049.png]]<blockquote>
<p>[!note] Strcpy Example
![[file-20241021131810673.png]]
![[file-20241021131827015.png]]</p>
</blockquote>
</li>
</ul>
</li>
</ul>
<h1 id="addressing">Addressing<a class="headerlink" href="#addressing" title="Permanent link">&para;</a></h1>
<h2 id="1-risc-v-addressing-for-32-bit-immediate-and-addresses">1 RISC-V Addressing for 32-bit Immediate and Addresses 超大立即数加载<a class="headerlink" href="#1-risc-v-addressing-for-32-bit-immediate-and-addresses" title="Permanent link">&para;</a></h2>
<p>虽然在大多数情况下，立即数不会很大（≤<span class="arithmatex">\(2^12\)</span>），能够直接存在指令中；但如果超过 12 位，RISC-V 会用<code>lui</code> (load upper immediate) 指令来处理这类较大的立即数。</p>
<ul>
<li><code>lui</code>的指令格式为 U-type</li>
<li>它可以加载立即数的<strong>高 20 位</strong>，将其放入寄存器中间的第 12 位到第 31 位，寄存器的低 12 位用 0 填充，高 32 位用第 31 位上的数字填充</li>
<li>举个例子：要将 32 位立即数赋给寄存器，可以先用<code>lui</code>指令将高 20 位赋给寄存器，之后用<code>addi</code>指令将剩余的 12 位加到寄存器中（具体见下面的“例题”）</li>
</ul>
<h2 id="2-addressing-mode">2 Addressing Mode<a class="headerlink" href="#2-addressing-mode" title="Permanent link">&para;</a></h2>
<p>![[file-20241021134200405.png]]</p>
<h3 id="21-branch-addressing">2.1 Branch Addressing<a class="headerlink" href="#21-branch-addressing" title="Permanent link">&para;</a></h3>
<p>默认立即数末尾补0，分支指令是PC相对寻址
<div class="language-text highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>bne x10,x11,32 #存储的是16
</span></code></pre></div>
![[file-20241021133413404.png]]</p>
<h3 id="22-jump-addressing">2.2 Jump  Addressing<a class="headerlink" href="#22-jump-addressing" title="Permanent link">&para;</a></h3>
<p>![[file-20241021133439755.png]]
![[file-20241021133517443.png]]
branch指令的offset最后一位是符号位
- 虽然大部分的跳转地址离分支指令都比较近（根据 SPEC 测试，一半左右的分支指令跳转距离不超过 16 条指令），但是仍会存在一些跳转距离很远，超过 12 位地址的指令。这时汇编器会采取以下挽救措施：
    - 插入一条无条件分支指令，它的跳转地址即为目标跳转地址
    - 将原来条件分支指令的条件取反，让条件分支语句自行决定是否跳过无条件分支</p>
<blockquote>
<p>[!note] example
<code>beq x10,x0,L1</code>
如果<code>L1</code>地址过远，这条指令将被替换成以下指令：
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>bne x10,x0,L2
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a>jal x0,L1
</span></code></pre></div></p>
</blockquote>
<h3 id="23-summary">2.3 Summary<a class="headerlink" href="#23-summary" title="Permanent link">&para;</a></h3>
<p>寻址模式（addressing mode）：决定此架构下机器语言指令对于的运算数
![[file-20241021132629772.png]]
- <strong>立即寻址</strong>(immediate addressing)：操作数为指令内的立即数
- <strong>寄存器寻址</strong>(register addressing)：操作数为寄存器
- <strong>基址或偏移寻址</strong>(base or displacement addressing)：操作数位于指定的内存位置上，该位置是寄存器和立即数之和
- <strong>PC 相对寻址</strong>(PC-relative addressing)：分支地址为 PC 和分支偏移量（立即数的 2 倍）之和
    <span class="arithmatex">\(<span class="arithmatex">\(\begin{align}Target~address=&amp;PC+Branch~offset\\=&amp;PC+immediate\times 2\end{align}\)</span>\)</span></p>
<h2 id="3-decoding-assembly-code">3 Decoding assembly code<a class="headerlink" href="#3-decoding-assembly-code" title="Permanent link">&para;</a></h2>
<ul>
<li>确定opcode</li>
<li>确定其他的区域</li>
<li>翻译为汇编语言<blockquote>
<p>[!info] example
![[file-20241021134456795.png]]</p>
</blockquote>
</li>
</ul>
<h3 id="31-summary">3.1 Summary<a class="headerlink" href="#31-summary" title="Permanent link">&para;</a></h3>
<p>![[file-20241021134532644.png]]
![[file-20241021134543756.png]]
![[file-20241021134554625.png]]</p>
<h2 id="4-risc-v">4 RISC-V中的同步<a class="headerlink" href="#4-risc-v" title="Permanent link">&para;</a></h2>
<ul>
<li>两个进程使用一片内存<ul>
<li>P1 writes, then P2 reads</li>
<li>Data race  如果P1 P2 没有同步</li>
</ul>
</li>
<li>硬件支持<ul>
<li>原子读写操作</li>
<li>读写之间不允许访问这块地址</li>
</ul>
</li>
</ul>
<p>有些处理器有专门实现原子操作的指令，比如原子交换 (atomic swap/exchange)（实现寄存器和内存数据的交换）等。而 RISC-V 提供了一个指令对 (instruction pair) <code>lr.d</code>和<code>sc.d</code>：</p>
<ul>
<li>
<p><code>lr.d</code>(load-reserved doubleword)：</p>
<ul>
<li>
<p>格式：</p>
<p><code>lr.d rd, (rs1)</code></p>
</li>
<li>
<p>功能：将存储在寄存器<code>rs1</code>的内存地址上的数据加载到寄存器<code>rd</code>上，同时保留这块内存地址，除<code>sc.d</code>的其他指令不应该访问这块地址</p>
</li>
</ul>
</li>
<li>
<p><code>sc.d</code>(store-conditional doubleword)：</p>
<ul>
<li>格式：
<code>sc.d rd, rs1, (rs2)</code></li>
<li>功能：<ul>
<li>将寄存器<code>rs1</code>上的数据放入存储在寄存器<code>rs2</code>的内存地址上</li>
<li>并且由寄存器<code>rd</code>指示该指令是否成功：若成功，则<code>rd = 0</code>，否则<code>rd</code>为一个非零值（表示有其他指令访问过这块内存空间）<blockquote>
<p>[!note] Example1:原子交换
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>again:
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>   lr.d x10,(x20)
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>   sc.d x11,x23,(x20)
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a>   bne x11,x0,again
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a>   addi x23,x10,0
</span></code></pre></div></p>
<blockquote>
<p>[!note] Example2：加锁&amp;解锁
```
  addi x12, x0, 1
again:
  lr.d x10, (x20)
  bne x10, x0, again
  sc.d x11, x12, (x20)
  bne x11,x0,again
  sd x0, 0(x20)</p>
</blockquote>
</blockquote>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="5-translating-and-starting-a-program">5 Translating and starting a program<a class="headerlink" href="#5-translating-and-starting-a-program" title="Permanent link">&para;</a></h2>
<p>==to do ==</p>
<h2 id="6-arrays-versus-pointers">6 Arrays versus Pointers<a class="headerlink" href="#6-arrays-versus-pointers" title="Permanent link">&para;</a></h2>
<h2 id="7-mips-instructions">7 MIPS Instructions<a class="headerlink" href="#7-mips-instructions" title="Permanent link">&para;</a></h2>
<h2 id="8-x86-instructions">8 x86 Instructions<a class="headerlink" href="#8-x86-instructions" title="Permanent link">&para;</a></h2>
<h2 id="9-risc-v">9 其他RISC-V指令<a class="headerlink" href="#9-risc-v" title="Permanent link">&para;</a></h2>
<p>![[file-20241021144153007.png]]
- M： integer multiply, divide , remainder
- A: atomic memory operations
- F：single-precision floating point
- D： double-precision floating point
- C: compressed instructions
    - 16-bit encoding for frequently used instructions</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.6ce7567c.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.88dd0f4e.min.js"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="../../../../javascripts/katex.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/katex.min.js"></script>
      
        <script src="https://unpkg.com/katex@0/dist/contrib/auto-render.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>